
<script src="/custom_bt/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/custom_bt/css/bootstrap.min.css">
<!--<span class=hevi>폰트확인</span>
<span style="font-size:3em;">폰트확인</span> !-->
<% @menulist.each do|menu| %>
<div class=menuitem>
  <div class=menuinfo onclick="toggle_detail(<%=menu.id%>)" id=<%=menu.id%>menu>
    <div class=menuinfo_text>  
      <div class=menutitle_kr>
        <span><%= menu.menu_title%></span>
      </div>
      <div class=menuprice>
        <span><%= menu.menu_price%>원</span>
      </div>
    </div>
  </div>
  <div class=menuaddorder id=<%=menu.id%>detail>  
    <div class="menu_adjust adjust_quantity">
      <div class="adjust_left">
        <span>수량</span>
      </div>
      <div class=adjust_right>
       <div class=adjust_value id=adjust_quantity><span id=<%=menu.id%>quantity>1</span></div>
     </div>
    </div>
    <div class="menu_adjust adjust_size">
      <div class=adjust_left>
        <span>사이즈</span>
      </div>
      <div class=adjust_right>
        <div onclick="order_size('s', <%=menu.id%>)" class=image_icon><img class=left_arrow src=/img/left_arrow.jpg></div>
        <div class=adjust_value><span id=<%=menu.id%>size>Regular</span></div>
        <div onclick="order_size('b', <%=menu.id%>)"class=image_icon><img class=right_arrow src=/img/right_arrow.jpg></div>
      </div>
    </div>
    <div class="menu_adjust adjust_shot ">
      <div class=adjust_left>
        <span>샷 추가</span>
      </div>
      <div class=adjust_right>
        <div onclick="order_shot('minus', <%=menu.id%>)" class=image_icon><img class=left_arrow src=/img/left_arrow.jpg></div>
        <div class=adjust_value><span id=<%=menu.id%>shot>None</span></div>
        <div onclick="order_shot('add', <%=menu.id%>)" class=image_icon><img class=right_arrow src=/img/right_arrow.jpg></div>
      </div>
    </div>
    <div onclick="modify_long(<%=menu.id%>)" data-toggle=modal class="menu_adjust">
      <div class="adjust_left">
        <span>추가사항</span>
      </div>
      <div class="adjust_right long_option" style="height:5vh; width:60%;border-bottom:solid 1px black;">
        <input type=text class=long_option id=<%=menu.id%>long_option style="background:none; text-align:center;" placeholder="입력하세요" disabled>
      </div>
    </div>
    <div onclick="add_order(<%=menu.id%>)"class="menu_adjust add_order">
	<% if @mod=="true" %>
	  <span>수정하기</span>
	<% else %>
      <span>주문하기</span>
	<% end %>
    </div>
  </div>
</div>
</div>
<% end %>
<!--long_option modal-->
<div class="modal fade" id="long_option_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <span id=menu_id_modal style="display:none;"></span>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">추가 주문사항</h4>
      </div>
      <div class="modal-body">
          <div class="form-group">
            <textarea style="width:100%;" id="message-text"></textarea>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
        <button type="button" class="btn btn-primary" onclick="save_long()">등록하기</button>
      </div>
    </div>
  </div>
</div>


<script>
    var size_match = {'Regular':0, 'Large':1, 'Jumbo':2};
    var shot_match = {'None':0, '1샷 추가':1, '2샷 추가':2};

  function add_order(menu_id){
    var menu_id = menu_id
    var menu_size = $("#"+menu_id+"size").text();
    var menu_shot = $("#"+menu_id+"shot").text();
    var menu_long_option = $("#"+menu_id+"long_option").val();
   

  var menu_title = $("#"+menu_id+"menu>div>div.menutitle_kr>span").text();
  var shot_price = 300;
  var size_price = size_match[menu_size]*300
  var menu_price = parseInt($("#"+menu_id+"menu>div>div.menuprice>span").text())+ shot_match[menu_shot] * shot_price + size_price
  var to_android = {'menu_title': menu_title,'menu_price':menu_price, 'count':"1", 'menu_option':"샷 추가:"+menu_shot+",Size:"+menu_size, 'long_option':menu_long_option}; 
  console.log(to_android);
  <% if @mod=="true" %>
	/*to_android.sim_serial = '<%= @sim_serial%>';
	to_android.shop_id = '<%= @shop_id%>';
	$.ajax({
		url: "http://bringit.kr/main/modify_daily",
		data: to_android,
		success: function(){
			window.android.modify(JSON.stringify(to_android));
			}
		});*/
	to_android.sim_serial = '<%= @sim_serial%>';
	to_android.shop_id = '<%= @shop_id%>';
	window.android.modify(JSON.stringify(to_android));
  <% else %>
	window.android.order(JSON.stringify(to_android)); 
	$("#"+menu_id+"detail").hide();
  <% end%>

  };
  
  function toggle_detail(menu_id){
    var menu_id= menu_id;
    
    if($("#"+menu_id+"detail").css("display") == "none"){
      $(".menuaddorder").hide();
      $("#"+menu_id+"detail").show();
      $('html, body').animate({
        scrollTop: $("#"+menu_id+"menu").offset().top
      }, 700);
    } else {
        $("#"+menu_id+"detail").hide();
    };
    
  };

  function order_size(type, id){
    menu_id = id;
    current_size = size_match[$("#"+menu_id+"size").html()];
    console.log(current_size);
    window.android.vibration(); 
    if (type === "b"){
      if (current_size<2){
        current_size++;
      };
      
      
    }else{
      if (current_size>0){
        current_size--;
      };
    };
    $("#"+menu_id+"size").html(Object.keys(size_match)[current_size]);
  };
  
  function order_shot(type, id){
    menu_id = id;
    current_shot = shot_match[$("#"+menu_id+"shot").html()];
    console.log(current_shot);
    window.android.vibration();
    if (type === "add"){
      if (current_shot<2){
        current_shot++;
      };
      
    }else{
      if (current_shot>0){
        current_shot--;
      };
    };
    $("#"+menu_id+"shot").html(Object.keys(shot_match)[current_shot]);
    
  }
  
  function modify_long(menu_id){
    current_long = $("#"+menu_id+"long_option");
    $("#message-text").val($("#"+menu_id+"long_option").val());
    
    $("#menu_id_modal").html(menu_id);
    $('#long_option_modal').modal('toggle');
    
  };
  function save_long(){
    menu_id = $("#menu_id_modal").html();
    $("#"+menu_id+"long_option").val($("#message-text").val());
    // document.getElementById(menu_id+"long_option").innerHTML = $("#message-text").val()
    $("#long_option_modal").modal('toggle');
    
  };
    
    $(window).load(function() {
      $('#loading').hide();
    });

</script>
